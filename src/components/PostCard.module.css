/* Liquid glass card – no shadow/glow, outline only. Promoted to own layer so scale doesn't jitter action row. */
.card {
  position: relative;
  border-radius: var(--glass-radius);
  overflow: visible;
  min-width: 0;
  background: var(--glass-bg);
  -webkit-backdrop-filter: blur(var(--glass-blur));
  backdrop-filter: blur(var(--glass-blur));
  box-shadow: none;
  -webkit-tap-highlight-color: transparent;
  isolation: isolate;
  /* Reserve space above when scrollIntoView runs so fixed header doesn't cover the card */
  scroll-margin-top: 5rem;
  container-type: inline-size;
  container-name: postcard;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  will-change: transform;
  transform-origin: center center;
}

.cardLink {
  display: block;
  text-decoration: none;
  color: inherit;
  cursor: pointer;
  border-radius: var(--glass-radius);
  overflow: visible;
  -webkit-tap-highlight-color: transparent;
}

/* Ring layer above media so it's never clipped; pointer-events: none so clicks hit the card */
.card::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  z-index: 1;
  box-shadow: none;
}

/* Focused/selected: lift toward user (scale + shadow), no outline */
.cardSelected {
  outline: none;
  z-index: 1;
  transform: scale(1.05);
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.15);
}
.cardSelected::after {
  box-shadow: none;
}
html[data-theme="dark"] .cardSelected {
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.35);
}

/* Single column: no drop shadow when selected so sides don’t glow at screen edge */
[data-view-mode="1"] .cardSelected {
  box-shadow: none;
}
html[data-theme="dark"] [data-view-mode="1"] .cardSelected {
  box-shadow: none;
}

/* Pink ring when post is liked */
.cardLiked {
  outline: none;
}
.cardLiked::after {
  box-shadow: inset 0 0 0 2px #ec4899;
}

/* Light blue ring when post is in an artboard */
.cardInArtboard {
  outline: none;
}
.cardInArtboard::after {
  box-shadow: inset 0 0 0 2px #7dd3fc;
}

/* Trans flag border (pink, light blue, white, light blue, pink) when liked + in artboard */
.cardTransFlag {
  outline: none;
  box-shadow: none;
  overflow: visible;
  background: transparent;
  padding: 2px;
  border: none;
}
.cardTransFlag::before {
  content: '';
  position: absolute;
  inset: 0;
  z-index: -1;
  border-radius: var(--glass-radius);
  background: linear-gradient(
    to bottom,
    #5BCCFA 0%,
    #7DD3FC 10%,
    #9EE0FD 20%,
    #ec4899 20%,
    #ec4899 40%,
    #ec4899 49%,
    #000000 49%,
    #4a4a4a 49.45%,
    #ffffff 50%,
    #4a4a4a 50.55%,
    #000000 51%,
    #ec4899 51%,
    #ec4899 60%,
    #ec4899 80%,
    #5BCCFA 80%,
    #7DD3FC 90%,
    #9EE0FD 100%
  );
  pointer-events: none;
}
.cardTransFlag .cardLink {
  background: var(--surface);
  border-radius: calc(var(--glass-radius) - 1px);
  border: 1px solid var(--glass-border);
  position: relative;
  z-index: 0;
}

/* Keep media (and overlays) inside the inner radius so they don’t cover the trans-flag ring */
.cardTransFlag .cardLink .mediaWrap,
.cardTransFlag .cardLink .nsfwOverlay {
  border-radius: calc(var(--glass-radius) - 1px) calc(var(--glass-radius) - 1px) 0 0;
}
.cardTransFlag.cardArtOnly .cardLink .mediaWrap,
.cardTransFlag.cardArtOnly .cardLink .nsfwOverlay {
  border-radius: calc(var(--glass-radius) - 1px);
}
.cardTransFlag .cardLink .textOnlyPreview {
  border-radius: calc(var(--glass-radius-sm) - 1px) calc(var(--glass-radius-sm) - 1px) 0 0;
}

/* Darken card when marked as seen (scrolled past) */
.cardSeen {
  filter: brightness(0.82);
}
/* Dark mode: stronger seen dimming so the difference from unseen is clear */
html[data-theme="dark"] .cardSeen {
  filter: brightness(0.68);
}

/* Hover: lift toward user (scale + shadow, no purple ring) */
.card:hover {
  outline: none;
  transform: scale(1.05);
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.15);
}
.card:hover::after {
  box-shadow: none;
}
html[data-theme="dark"] .card:hover {
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.35);
}
[data-view-mode="1"] .card:hover {
  box-shadow: none;
}
html[data-theme="dark"] [data-view-mode="1"] .card:hover {
  box-shadow: none;
}

/* When navigating with keyboard (W/S/A/D), only the selected card lifts – not the card under the mouse */
[data-feed-cards][data-keyboard-nav] .card:hover:not(.cardSelected) {
  outline: none;
  transform: none;
  box-shadow: none;
}
[data-feed-cards][data-keyboard-nav] .card:hover:not(.cardSelected)::after {
  box-shadow: none;
}
[data-feed-cards][data-keyboard-nav] .card.cardLiked:hover:not(.cardSelected)::after {
  box-shadow: inset 0 0 0 2px #ec4899;
}
[data-feed-cards][data-keyboard-nav] .card.cardInArtboard:hover:not(.cardSelected)::after {
  box-shadow: inset 0 0 0 2px #7dd3fc;
}
[data-feed-cards][data-keyboard-nav] .card.cardTransFlag:hover:not(.cardSelected) {
  outline: none;
}

/* Liked + hover: keep pink ring only */
.card.cardLiked:hover::after {
  box-shadow: inset 0 0 0 2px #ec4899;
}

/* When focused/selected: card lifts; ::after only has liked/artboard inset rings */
.card.cardSelected::after,
.card.cardSelected.cardInArtboard::after {
  box-shadow: none;
}
/* Pink inset when liked + focused */
.card.cardSelected.cardLiked::after {
  box-shadow: inset 0 0 0 2px #ec4899;
}

/* Bento grid: card fills cell height */
.cardFillCell {
  height: 100%;
  min-height: 0;
  display: flex;
  flex-direction: column;
}
.cardFillCell .cardLink {
  flex: 1;
  min-height: 0;
  display: flex;
  flex-direction: column;
}
.cardFillCell .meta {
  flex-shrink: 0;
}

.cardLink:hover {
  text-decoration: none;
}

.cardLink:focus {
  outline: none;
}

/* No purple focus ring – card uses lift instead; override global [tabindex="0"]:focus-visible */
.cardLink:focus-visible {
  outline: none !important;
  box-shadow: none !important;
}
/* Keyboard focus: no outline; lift card when focus is not on a media cell (see below) */
.card:focus-within {
  outline: none !important;
  z-index: 1;
}
/* Lift card (scale + shadow) only when focus is not on a media grid cell – otherwise card scale + cell scale makes the top image’s corners extend past the card’s rounded clip */
.card:focus-within:not(:has(.mediaGridCellFocused)) {
  transform: scale(1.05);
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.15);
}
.card:focus-within:not(:has(.mediaGridCellFocused))::after {
  box-shadow: none;
}
html[data-theme="dark"] .card:focus-within:not(:has(.mediaGridCellFocused)) {
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.35);
}
[data-view-mode="1"] .card:focus-within:not(:has(.mediaGridCellFocused)) {
  box-shadow: none;
}
html[data-theme="dark"] [data-view-mode="1"] .card:focus-within:not(:has(.mediaGridCellFocused)) {
  box-shadow: none;
}

.addWrap {
  position: relative;
  margin-left: auto;
  display: inline-flex;
  align-items: center;
  opacity: 1;
  transition: opacity 0.15s ease;
}

.addWrapOpen {
  opacity: 1;
}

/* Action row: download absolute left; center (Collect, avatar, Like); menu absolute right */
.cardActionRow {
  position: relative;
  display: flex;
  align-items: center;
  margin-bottom: 0.35rem;
}

.cardActionRowCenter {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.875rem;
  min-width: 0;
}

@media (max-width: 767px) {
  .card {
    -webkit-user-select: none;
    user-select: none;
  }
  .cardActionRowCenter {
    gap: 0.35rem;
  }
}

.cardActionRowLeft {
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  flex-shrink: 0;
}

.cardActionRowRight {
  position: absolute;
  right: 0;
  top: 50%;
  transform: translateY(-50%);
  flex-shrink: 0;
}

/* When card is narrow enough that download/menu would overlap collect+like, hide them */
@container postcard (max-width: 200px) {
  .cardActionRowLeft,
  .cardActionRowRight {
    display: none;
  }
}

.cardActionRow .addWrap {
  margin-left: 0;
}

/* Profile picture in action row between collect and like (all viewports) */
.cardActionRowAvatar {
  display: block;
  flex-shrink: 0;
  border-radius: 50%;
  overflow: visible;
  line-height: 0;
  position: relative;
  width: 1.35rem;
  height: 1.35rem;
}
.cardActionRowAvatar img {
  width: 1.35rem;
  height: 1.35rem;
  object-fit: cover;
  display: block;
  border-radius: 50%;
}
.cardActionRowAvatarFollow {
  padding: 0;
  border: none;
  background: none;
  cursor: pointer;
  border-radius: 50%;
  -webkit-tap-highlight-color: transparent;
}
.cardActionRowAvatarFollow:hover:not(:disabled) {
  opacity: 0.9;
}
.cardActionRowAvatarFollow:disabled {
  opacity: 0.7;
  cursor: default;
}
/* Add (+) badge at bottom-right of avatar: dark circle, light border, plus icon */
.cardActionRowAvatarPlus {
  position: absolute;
  right: -2px;
  bottom: -2px;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--text);
  border: 2px solid var(--surface);
  color: var(--surface);
  display: grid;
  place-items: center;
  flex-shrink: 0;
  padding: 0;
  transition: transform 0.15s ease;
  /* Whole-pixel size + layer to avoid sub-pixel blur */
  transform: translateZ(0);
}
.cardActionRowAvatarPlus svg {
  width: 8px;
  height: 8px;
  stroke: currentColor;
  shape-rendering: geometricPrecision;
}
.cardActionRowAvatarPlus svg path {
  vector-effect: non-scaling-stroke;
}
.cardActionRowAvatarFollow:hover:not(:disabled) .cardActionRowAvatarPlus {
  transform: translateZ(0) scale(1.08);
}
.cardActionRowAvatarFollow:active:not(:disabled) .cardActionRowAvatarPlus {
  transform: translateZ(0) scale(0.95);
}
/* All column views: show avatar in action row only, hide duplicate next to username */
[data-view-mode="1"] .handleRow .authorAvatar,
[data-view-mode="1"] .handleRow .authorAvatarPlaceholder,
[data-view-mode="2"] .handleRow .authorAvatar,
[data-view-mode="2"] .handleRow .authorAvatarPlaceholder,
[data-view-mode="3"] .handleRow .authorAvatar,
[data-view-mode="3"] .handleRow .authorAvatarPlaceholder {
  display: none;
}

@media (max-width: 767px) {
  /* Stack profile picture centered above username */
  .handleRow {
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
  }
  .handleRow .authorAvatar,
  .handleRow .authorAvatarPlaceholder {
    width: 2rem;
    height: 2rem;
  }
  .handleRow .authorAvatarPlaceholder {
    font-size: 0.8rem;
  }
  .handleRowMain {
    justify-content: center;
  }
  .handleRowMeta {
    justify-content: center;
  }
  /* Preview cards on mobile: action row avatar slightly larger for touch */
  .cardActionRowAvatar img {
    width: 1.5rem;
    height: 1.5rem;
  }
  .cardActionRowAvatar {
    width: 1.5rem;
    height: 1.5rem;
  }
  /* 3-column view on mobile: compact avatar */
  [data-view-mode="3"] .cardActionRowAvatar img {
    width: 1.1rem;
    height: 1.1rem;
  }
  [data-view-mode="3"] .cardActionRowAvatar {
    width: 1.1rem;
    height: 1.1rem;
  }
  /* No purple focus/selected ring on mobile – touch only; keep liked (pink) and collected (blue) rings */
  .cardSelected::after,
  .card:hover::after {
    box-shadow: none;
  }
  .card.cardSelected.cardLiked::after {
    box-shadow: inset 0 0 0 2px #ec4899;
  }
  .card.cardSelected.cardInArtboard::after {
    box-shadow: inset 0 0 0 2px #7dd3fc;
  }
  .cardLink:focus-visible {
    outline: none;
  }
}

/* Minimalist: only collect + like; no handle/text. Card rounded top only so it doesn’t clip the media; meta row draws rounded bottom so media corners stay visible (like full card view). */
.cardMinimalist {
  border-radius: var(--glass-radius) var(--glass-radius) 0 0;
  overflow: visible;
}
/* Same as full card: preview (cardLink) fully rounded – .cardLink uses border-radius: var(--glass-radius) */
.cardMinimalist .cardLink {
  border-radius: var(--glass-radius);
}
/* Match full card: media rounded so bottom of preview is rounded like full view (art-only uses same for media) */
.cardMinimalist .mediaWrap,
.cardMinimalist .nsfwOverlay {
  border-radius: var(--glass-radius);
}
.cardMinimalist .meta {
  margin-bottom: 0;
  border-radius: 0 0 var(--glass-radius) var(--glass-radius);
  background: var(--glass-bg);
  -webkit-backdrop-filter: blur(var(--glass-blur));
  backdrop-filter: blur(var(--glass-blur));
}
.cardMinimalist .cardActionRow {
  margin-bottom: 0;
}

/* Mini + art-only: no meta row, so the card div is the bottom – give it rounded bottom like full card */
.cardMinimalist.cardArtOnly {
  border-radius: var(--glass-radius);
}
/* Image/media stays square at bottom; only the card wrapper is rounded there */
.cardMinimalist.cardArtOnly .mediaWrap,
.cardMinimalist.cardArtOnly .nsfwOverlay {
  border-radius: var(--glass-radius) var(--glass-radius) 0 0;
}

.cardLikeRepostBtn {
  width: 1.85rem;
  height: 1.85rem;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.35rem;
  line-height: 1;
  background: transparent;
  color: var(--muted);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  outline: none;
  transition: transform 0.2s ease, color 0.15s ease;
}

.cardLikeRepostBtn:hover:not(:disabled) {
  color: var(--accent);
}

.cardLikeRepostBtn:focus-visible {
  outline: none;
  transform: scale(1.03);
}

.cardLikeRepostBtnActive {
  background: linear-gradient(135deg, #db2777 0%, #ec4899 50%, #f472b6 100%);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
}
.cardLikeRepostBtnActive:hover:not(:disabled) {
  color: transparent;
  filter: brightness(0.85);
}
.cardLikeRepostBtnActive::selection {
  color: #fff;
}

.cardLikeRepostBtn:disabled {
  opacity: 0.7;
  cursor: default;
}

.cardDownloadBtn {
  width: 1.85rem;
  height: 1.85rem;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--muted);
  background: none;
  border: none;
  border-radius: 0.25rem;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}
.cardDownloadBtn:hover:not(:disabled) {
  color: var(--accent);
}
.cardDownloadBtn:disabled {
  opacity: 0.7;
  cursor: default;
}
.cardDownloadBtn .downloadIcon {
  width: 1.1rem;
  height: 1.1rem;
}

.addToBoardBtn {
  width: 2rem;
  height: 2rem;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.15rem;
  line-height: 1;
  font-weight: 600;
  color: var(--muted);
  background: transparent;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  outline: none;
  transition: transform 0.2s ease, color 0.15s ease;
}

.addToBoardBtn:hover {
  color: var(--accent);
}

.addToBoardBtn:focus-visible {
  outline: none;
  transform: scale(1.03);
}

.addToBoardBtnInCollection {
  color: #55CDFC;
}

.addToBoardBtnInCollection .collectIcon {
  fill: currentColor;
}

.addToBoardBtnInCollection:hover {
  color: #4bc4f0;
}

.collectIcon {
  width: 1.1rem;
  height: 1.1rem;
}

.addDropdown {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-bottom: 0.25rem;
  min-width: 200px;
  max-height: 70vh;
  overflow-y: auto;
  padding: 0.5rem;
  background: var(--glass-bg-strong);
  -webkit-backdrop-filter: blur(var(--glass-blur-strong));
  backdrop-filter: blur(var(--glass-blur-strong));
  border: 1px solid var(--glass-border);
  border-radius: var(--glass-radius-sm);
  box-shadow: var(--shadow-dropdown);
  z-index: 100;
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
}

/* Portaled to body: stay fixed in viewport where opened (don't scroll with feed) */
/* Portaled: fixed so dropdown doesn't scroll with page; left/bottom set inline and updated on scroll */
.addDropdownFixed {
  position: fixed !important;
  transform: translateX(-50%);
  margin-bottom: 0.25rem;
}

.addBoardLabel {
  display: flex;
  align-items: center;
  gap: 0.35rem;
  font-size: 0.85rem;
  color: var(--text);
  cursor: pointer;
}

.addBoardLabel:has(input:disabled) {
  cursor: default;
  color: var(--muted);
}

.addBoardCheckbox {
  width: 0.9rem;
  height: 0.9rem;
}

.addBoardText {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
}

.addDropdownNew {
  margin-top: 0.2rem;
  padding-top: 0.35rem;
  border-top: 1px solid var(--border);
}

.addBoardInput {
  width: 100%;
  box-sizing: border-box;
  padding: 0.4rem 0.5rem;
  font-size: 0.85rem;
  border: 1px solid var(--border);
  border-radius: 0.4rem;
  background: var(--bg);
  color: var(--text);
}

.addDropdownActions {
  margin-top: 0.25rem;
  padding-top: 0.35rem;
  border-top: 1px solid var(--border);
}

.addBoardSubmit {
  width: 100%;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  background: var(--accent-gradient);
  color: var(--text-on-accent);
  border: none;
  border-radius: 0.4rem;
  cursor: pointer;
  transition: filter 0.15s ease;
}

.addBoardSubmit:hover:not(:disabled) {
  filter: brightness(0.92);
}

.addBoardSubmit:disabled {
  opacity: 0.6;
  cursor: default;
}

.authorAvatar {
  width: 1.25rem;
  height: 1.25rem;
  border-radius: 50%;
  object-fit: cover;
  flex-shrink: 0;
}

.authorAvatarPlaceholder {
  width: 1.25rem;
  height: 1.25rem;
  border-radius: 50%;
  background: var(--muted);
  color: var(--text);
  font-size: 0.65rem;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  line-height: 1;
}

.mediaWrap {
  position: relative;
  width: 100%;
  aspect-ratio: 1; /* fallback until image loads (was 3/4, made cards too tall for landscape/square images) */
  min-height: 100px;
  max-height: var(--feed-card-media-max-height, none); /* 1-col feed: fit viewport */
  overflow: hidden;
  background: var(--bg);
  display: flex;
  align-items: center;
  justify-content: center;
  /* Round top to match card so media doesn’t stick out of corners */
  border-radius: var(--glass-radius) var(--glass-radius) 0 0;
}

/* Art only: no meta row, so round the bottom so corners don't stick through the focus ring */
.cardArtOnly .mediaWrap {
  border-radius: var(--glass-radius);
}
.cardArtOnly .nsfwOverlay {
  border-radius: var(--glass-radius);
}

/* Ensure media wrap clips the extended blur overlay so no overflow shows */
.mediaWrap {
  isolation: isolate;
}

/* Single-col profile/feed: fixed height from the start so media doesn't resize when image loads */
.mediaWrapConstrained {
  height: var(--feed-card-media-max-height);
  aspect-ratio: unset;
  min-height: unset;
}

/* NSFW blurred mode: overlay with blur and "Tap to reveal". Extended inset so blur covers corners (no color peeking). */
.nsfwOverlay {
  position: absolute;
  inset: -30px;
  z-index: 2;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--overlay-bg);
  -webkit-backdrop-filter: blur(20px);
  backdrop-filter: blur(20px);
  border-radius: var(--glass-radius) var(--glass-radius) 0 0;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}

.nsfwOverlay:hover {
  background: var(--overlay-bg);
}

.nsfwOverlayText {
  font-size: 0.95rem;
  font-weight: 500;
  color: var(--text-on-accent);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  pointer-events: none;
}

/* Bento: media wrap fills available space; show full image/video (no crop) */
.mediaWrapFillCell {
  flex: 1;
  min-height: 0;
  aspect-ratio: unset;
  max-height: none;
}

/* Multi-image stack: height from spacer (1/n aspect) so card isn't forced square; images get full width and scale up */
.mediaWrapMultiStack {
  aspect-ratio: unset;
  max-height: none;
  align-items: stretch;
}
.mediaWrapFillCell .media {
  width: 100%;
  height: 100%;
  object-fit: contain;
  object-position: center;
}
.mediaWrapFillCell video.media {
  width: 100%;
  height: 100%;
  object-fit: contain;
  object-position: center;
}

.textOnlyPreview {
  width: 100%;
  height: 100%;
  min-height: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  padding: 0.6rem 0.75rem;
  background: var(--surface);
  /* Only round top so bottom meets meta row flush (no empty corner gap) */
  border-radius: var(--glass-radius-sm) var(--glass-radius-sm) 0 0;
  color: var(--text);
  font-size: 0.88rem;
  line-height: 1.35;
  overflow: hidden;
}

.textOnlyPreviewText {
  display: -webkit-box;
  -webkit-line-clamp: 4;
  -webkit-box-orient: vertical;
  overflow: hidden;
  word-break: break-word;
  text-align: center;
  width: 100%;
}

.textOnlyPreviewEmpty {
  color: var(--muted);
  font-size: 0.9rem;
}

.textOnlyPreviewLink {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.35rem;
  margin-top: 0.5rem;
  padding: 0.5rem;
  max-width: 100%;
  text-align: center;
  color: inherit;
  text-decoration: none;
  border: 1px solid var(--glass-border);
  border-radius: var(--glass-radius-sm);
  background: var(--bg);
}

.textOnlyPreviewLink:hover {
  text-decoration: underline;
}

.textOnlyPreviewLinkThumb {
  width: 100%;
  max-height: 6rem;
  object-fit: cover;
  border-radius: 0.2rem;
}

.textOnlyPreviewLinkTitle {
  font-weight: 600;
  font-size: 0.9rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: 100%;
}

.textOnlyPreviewLinkDesc {
  font-size: 0.8rem;
  color: var(--muted);
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-align: center;
}

.mediaArrow {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 1.75rem;
  height: 1.75rem;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.75rem;
  line-height: 1;
  color: var(--text);
  background: var(--media-control-bg);
  border: none;
  border-radius: 0.25rem;
  cursor: pointer;
  z-index: 1;
  opacity: 0;
  transition: opacity 0.15s ease;
}

.mediaWrap:hover .mediaArrow {
  opacity: 1;
}

/* In-flow spacer so .mediaWrap gets height when multi-image grid (absolute) is only content */
.mediaWrapGridSpacer {
  width: 100%;
  aspect-ratio: 1;
  flex-shrink: 0;
  pointer-events: none;
}

/* Multi-image: vertical stack, no gaps – images fill card edge-to-edge */
.mediaWrapGrid {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  gap: 0;
  margin: 0;
  padding: 0;
  background: var(--bg);
  min-height: 0;
}

.mediaGrid {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  gap: 0;
  margin: 0;
  padding: 0;
  border: none;
  min-height: 0;
}

.mediaGridCell {
  position: relative;
  flex: 1;
  min-height: 0;
  min-width: 0;
  margin: 0;
  padding: 0;
  border: none;
  overflow: hidden;
  background: var(--bg);
  border-radius: 0;
  display: flex;
  align-items: stretch;
  justify-content: stretch;
  transition: transform 0.2s ease;
}

/* Keyboard focus: lift focused image toward user (scale only) when navigating with A/D */
.mediaGridCellFocused {
  outline: none;
  box-shadow: none;
  z-index: 1;
  transform: scale(1.04);
}

.mediaGridImg {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  border: none;
  vertical-align: top;
  object-fit: contain;
  object-position: center;
  display: block;
  min-width: 0;
  min-height: 0;
}

.mediaArrow:hover:not(:disabled) {
  background: var(--overlay-bg);
}

.mediaArrow:disabled {
  opacity: 0.35;
  cursor: default;
}

/* Never crop art: fill container and fit content inside with contain */
.media {
  width: 100%;
  height: 100%;
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  object-position: center;
  display: block;
}

.mediaWrap video.media {
  width: 100%;
  height: 100%;
  object-fit: contain;
  object-position: center;
}

/* Video wrapper: absolute fill so iOS Safari respects container size (video intrinsic size can break scaling) */
.mediaVideoWrap {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 0;
  min-height: 0;
}

.mediaVideoWrap .media {
  width: 100%;
  height: 100%;
  min-width: 0;
  min-height: 0;
  object-fit: contain;
  object-position: center;
}

.meta {
  position: relative;
  padding: 0.5rem 0.6rem;
  padding-bottom: 0.5rem;
  min-width: 0;
}

.handleBlock {
  display: flex;
  flex-direction: column;
  gap: 0.15rem;
}

.handleRow {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  gap: 0.35rem;
  width: 100%;
  min-width: 0; /* allow row to shrink so handleRowMain can truncate */
  flex-wrap: nowrap; /* keep username + repost on one line; username truncates */
}

.metaBadgeRow {
  display: flex;
  align-items: center;
  gap: 0.35rem;
  margin-top: 0.2rem;
}

.handleRowMain {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.35rem;
  min-width: 0;
  flex: 1 1 0; /* take remaining space so username can truncate; repost icon stays */
  overflow: visible; /* allow verified badge to show; .handleLink truncates the username */
}

.handleRowMeta {
  display: flex;
  align-items: center;
  gap: 0.35rem;
  flex-shrink: 0;
}

/* On preview cards only show the ... menu on the username row; hide add and time */
.handleRowMeta .addWrap,
.handleRowMeta .postTime {
  display: none;
}

.postTime {
  font-size: 0.8rem;
  color: var(--muted);
  white-space: nowrap;
}

.mobileActions {
  display: none;
}

.optionsRow {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  padding: 0.25rem 0.5rem;
  min-height: 0;
}

.mobileLikeBtn,
.mobileLikeBtnLiked {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  padding: 0.35rem 0.5rem;
  font-size: 0.85rem;
  background: none;
  border: none;
  border-radius: 0.35rem;
  color: var(--muted);
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}

.mobileLikeBtn:hover,
.mobileLikeBtnLiked:hover {
  color: var(--accent);
}

.mobileLikeBtnLiked {
  color: var(--accent);
}

.mobileLikeCount {
  font-size: 0.8rem;
  color: var(--muted);
}

.mobileLikeBtnLiked .mobileLikeCount {
  color: inherit;
}


.repostIconLink {
  display: inline-flex;
  align-items: center;
  color: var(--muted);
  text-decoration: none;
  flex-shrink: 0;
  cursor: pointer;
}

.repostIconLink:hover {
  color: var(--accent);
}

.repostIcon {
  width: 0.85rem;
  height: 0.85rem;
  opacity: 0.9;
}

.pinIconWrap {
  display: inline-flex;
  align-items: center;
  color: var(--muted);
  flex-shrink: 0;
}

.pinIcon {
  width: 0.85rem;
  height: 0.85rem;
  opacity: 0.9;
}

.handle {
  font-size: 0.8rem;
  color: var(--muted);
}

.handleLinkWrap {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  min-width: 0;
  max-width: 100%;
  overflow: hidden; /* clip username; verified badge has flex-shrink: 0 so it’s never clipped */
  font-size: 0.8rem;
}

.handleLinkWrapLiked {
  display: inline;
  color: #ec4899;
}

.handleLink {
  display: block;
  font-size: 0.8rem;
  color: var(--muted);
  text-decoration: none;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  cursor: pointer;
}

.timestamp {
  font-size: 0.75rem;
  color: var(--muted);
  margin-left: 0.25rem;
  flex-shrink: 0;
}

.handleLink:hover {
  color: var(--accent);
  text-decoration: underline;
}

.mediaBadge {
  display: inline-flex;
  align-items: center;
  color: var(--muted);
  flex-shrink: 0;
}

.mediaIcon {
  width: 0.9rem;
  height: 0.9rem;
  opacity: 0.85;
}

.text {
  margin: 0.25rem 0 0;
  font-size: clamp(0.75rem, 2.2vw + 0.5rem, 0.85rem);
  color: var(--text);
  line-height: 1.3;
  word-break: break-word;
  max-height: none;
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  text-align: center;
}
